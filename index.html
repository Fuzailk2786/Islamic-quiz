<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Questz - 2026</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f8fafc; --card-bg: #ffffff; --text-main: #064e3b;
            --emerald: #065f46; --gold: #b45309; --soft-gold: #fef3c7;
            --border: #e2e8f0; --shadow: rgba(0,0,0,0.1);
        }
        [data-theme="dark"] {
            --bg-color: #0f172a; --card-bg: #1e293b; --text-main: #f1f5f9;
            --emerald: #10b981; --gold: #fbbf24; --soft-gold: #334155;
            --border: #334155; --shadow: rgba(0,0,0,0.4);
        }

        body { font-family: 'Poppins', sans-serif; background: var(--bg-color); margin: 0; color: var(--text-main); transition: 0.3s; overflow-x: hidden; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #bismillah-overlay {
            position: fixed; inset: 0; background: #064e3b;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; z-index: 10000; transition: 1s;
            pointer-events: none; user-select: none;
        }
        .bismillah-text { color: #fbbf24; font-size: 2rem; margin-bottom: 20px; font-family: 'Cinzel'; opacity: 0; animation: fadeIn 2s forwards; }

        #sidebar {
            position: fixed; right: -280px; top: 0; width: 280px; height: 100%;
            background: var(--card-bg); z-index: 2000; transition: 0.3s;
            box-shadow: -5px 0 15px var(--shadow); padding-top: 20px;
        }
        #sidebar.open { right: 0; }
        .profile-section { padding: 20px; text-align: center; border-bottom: 2px solid var(--gold); }
        .avatar { width: 80px; height: 80px; border-radius: 50%; background: var(--soft-gold); margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 2rem; border: 2px solid var(--gold); position: relative; cursor: pointer; overflow: hidden; }
        #profile-img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: none; }

        .nav-item { padding: 12px 25px; display: flex; align-items: center; gap: 10px; color: var(--text-main); text-decoration: none; cursor: pointer; border-bottom: 1px solid var(--border); }
        .nav-item:hover { background: var(--soft-gold); }

        .mode-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .main-btn { background: var(--card-bg); border: 1px solid var(--border); padding: 15px; border-radius: 15px; cursor: pointer; transition: 0.2s; font-weight: 600; color: var(--text-main); }
        .main-btn:hover { border-color: var(--gold); transform: translateY(-2px); }

        .level-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0; }
        .lvl { padding: 15px 5px; border-radius: 12px; border: 2px solid var(--emerald); background: none; color: var(--text-main); font-weight: bold; cursor: pointer; }
        .lvl.locked { opacity: 0.3; background: #eee; cursor: not-allowed; }
        .lvl.completed { background: var(--emerald) !important; color: white !important; }

        .dua-card { background: var(--card-bg); border-left: 5px solid var(--gold); padding: 15px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 5px var(--shadow); text-align: right; }
        
        .hidden { display: none !important; }
        #menu-btn { position: fixed; top: 15px; right: 15px; font-size: 1.5rem; z-index: 2001; cursor: pointer; background: var(--gold); color: white; border: none; border-radius: 8px; width: 40px; height: 40px; }
        .back-btn { background: none; border: none; color: var(--gold); font-weight: bold; cursor: pointer; margin-bottom: 15px; font-size: 1rem; }
    </style>
</head>
<body>

    <div id="bismillah-overlay">
        <div class="bismillah-text">ÿ®Ÿêÿ≥ŸíŸÖŸê Ÿ±ŸÑŸÑŸéŸëŸ∞ŸáŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê Ÿ±ŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê</div>
        <div style="color: white; letter-spacing: 2px;">ISLAMIC QUESTZ</div>
    </div>

    <button id="menu-btn" class="hidden" onclick="toggleMenu()">‚ò∞</button>
    
    <nav id="sidebar">
        <div class="profile-section">
            <div class="avatar" onclick="document.getElementById('upload-pic').click()">
                <span id="avatar-init">?</span>
                <img id="profile-img" src="" alt="Profile">
            </div>
            <input type="file" id="upload-pic" class="hidden" accept="image/*" onchange="uploadImage(this)">
            <div id="user-display-name" style="font-weight: 600; margin-top: 5px;">Guest User</div>
        </div>
        <div class="nav-item" onclick="showScreen('home')">üè† Home</div>
        <div class="nav-item" onclick="showScreen('ramadan-grid')">üåô Ramadan Quiz</div>
        <div class="nav-item" onclick="showScreen('regular-grid')">üìñ Learning</div>
        <div class="nav-item" onclick="showHadith()">üìú Hadith of Day</div>
        <div class="nav-item" onclick="showDuas()">ü§≤ Daily Duas</div>
        <div class="nav-item" onclick="showScreen('feedback')">üí° Feedback</div>
        <div class="nav-item" onclick="shareApp()">üì§ Invite Friends</div>
        <div class="nav-item" onclick="toggleTheme()">üåì Theme Mode</div>
    </nav>

    <div id="main-container" class="hidden">
        <div class="app-card" style="margin: 0 auto; max-width: 500px; padding: 20px;">
            
            <div id="screen-auth">
                <h2 style="font-family: 'Cinzel'; text-align:center;">Welcome</h2>
                <div id="login-box" style="text-align:center;">
                    <input type="email" id="auth-email" class="auth-input" placeholder="Enter Email" style="width: 80%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: 1px solid var(--border);">
                    <button class="main-btn" style="width: 85%; background: var(--emerald); color: white;" onclick="handleAuth('register')">Register & Login</button>
                    <div style="margin: 15px 0;">OR</div>
                    <button class="main-btn" style="width: 85%; background: var(--gold); color: white;" onclick="handleAuth('guest')">Continue as Guest</button>
                </div>
            </div>

            <div id="screen-home" class="hidden">
                <h1 style="font-family: 'Cinzel'; text-align:center;">Islamic Questz</h1>
                <div class="mode-grid">
                    <div class="main-btn" onclick="showScreen('ramadan-grid')">üåô<br>Ramadan Quiz</div>
                    <div class="main-btn" onclick="showScreen('regular-grid')">üìñ<br>Learning</div>
                    <div class="main-btn" onclick="showHadith()">üìú<br>Daily Hadith</div>
                    <div class="main-btn" onclick="showDuas()">ü§≤<br>Daily Duas</div>
                </div>
                <button id="install-btn" class="main-btn" style="width: 100%; margin-top: 20px; background: #3b82f6; color: white;">üì≤ Install App</button>
            </div>

            <div id="screen-content" class="hidden">
                <button class="back-btn" onclick="showScreen('home')">‚Üê Back</button>
                <div id="dynamic-body"></div>
            </div>

        </div>
    </div>

    

    <script>
        // --- DATA ---
        const DUA_DB = [
            { t: "Before Eating", a: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê", tr: "In the name of Allah" },
            { t: "After Eating", a: "ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê ÿßŸÑŸéŸëÿ∞ŸêŸä ÿ£Ÿéÿ∑ŸíÿπŸéŸÖŸéŸÜŸéÿß", tr: "Praise be to Allah who fed us" },
            { t: "Before Sleeping", a: "ÿ®Ÿêÿßÿ≥ŸíŸÖŸêŸÉŸé ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ£ŸéŸÖŸèŸàÿ™Ÿè ŸàŸéÿ£Ÿéÿ≠ŸíŸäŸéÿß", tr: "In Your name O Allah I die and live" }
        ];

        const HADITH_LIST = [
            "The best among you are those who learn the Quran and teach it.",
            "Cleanliness is half of faith.",
            "A good word is a charity.",
            "He who does not show mercy to others will not be shown mercy."
        ];

        // --- CORE ENGINE ---
      window.addEventListener('load', () => {
    console.log("App loaded. Starting timer...");
    
    // Safety Force-Hide: This hides the screen even if other code crashes
    setTimeout(() => {
        const overlay = document.getElementById('bismillah-overlay');
        const main = document.getElementById('main-container');
        
        if (overlay) {
            overlay.style.opacity = '0';
            // Important: We set pointer-events to none immediately
            overlay.style.pointerEvents = 'none'; 
            
            setTimeout(() => {
                overlay.classList.add('hidden');
                if (main) main.classList.remove('hidden');
                console.log("Overlay hidden, showing main container.");
                checkExistingLogin();
            }, 800);
        }
    }, 2500);
});

        function handleAuth(type) {
            let user = { name: "", avatar: "" };
            if(type === 'guest') {
                user.name = "Guest_" + Math.floor(Math.random() * 9000);
            } else {
                const val = document.getElementById('auth-email').value;
                if(!val.includes('@')) return alert("Valid email required");
                user.name = val.split('@')[0];
            }
            localStorage.setItem('iq_user', JSON.stringify(user));
            loginUser(user);
        }

        function loginUser(user) {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('screen-home').classList.remove('hidden');
            document.getElementById('menu-btn').classList.remove('hidden');
            document.getElementById('user-display-name').innerText = user.name;
            document.getElementById('avatar-init').innerText = user.name[0].toUpperCase();
        }

        function checkExistingLogin() {
            const saved = localStorage.getItem('iq_user');
            if(saved) loginUser(JSON.parse(saved));
        }

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }

        function showScreen(id) {
            const screens = ['screen-auth', 'screen-home', 'screen-content'];
            screens.forEach(s => document.getElementById(s).classList.add('hidden'));
            
            if(id === 'ramadan-grid') {
                renderRamadanGrid();
                document.getElementById('screen-content').classList.remove('hidden');
            } else if (id === 'regular-grid') {
                // Future Learning Logic
                document.getElementById('screen-content').classList.remove('hidden');
                document.getElementById('dynamic-body').innerHTML = "<h2>Learning Pathways</h2><p>Coming Soon!</p>";
            } else {
                document.getElementById('screen-' + id).classList.remove('hidden');
            }
            
            if(document.getElementById('sidebar').classList.contains('open')) toggleMenu();
        }

        // --- RAMADAN LOGIC ---
        function renderRamadanGrid() {
            const container = document.getElementById('dynamic-body');
            container.innerHTML = '<h2>Ramadan Challenge 2026</h2><div class="level-grid" id="grid"></div>';
            
            const ramadanStart = new Date('2026-02-18');
            const diff = Math.floor((new Date() - ramadanStart) / 86400000) + 1;

            for(let i=1; i<=31; i++) {
                const btn = document.createElement('button');
                btn.className = 'lvl';
                btn.innerText = i === 31 ? "EID" : i;
                
                if(i > diff) {
                    btn.classList.add('locked');
                    btn.onclick = () => alert("Unlocks on Day " + i);
                } else {
                    const done = localStorage.getItem('lvl_'+i);
                    if(done) btn.classList.add('completed');
                    btn.onclick = () => i === 31 ? startEidQuiz() : startRamadanLevel(i);
                }
                document.getElementById('grid').appendChild(btn);
            }
        }

        function startRamadanLevel(levelNum) {
            if (typeof RAMADAN_QUESTIONS === 'undefined') return alert("Error: Questions not loaded.");
            const questions = RAMADAN_QUESTIONS[`level${levelNum}`];
            if (!questions) return alert("Coming soon!");

            const body = document.getElementById('dynamic-body');
            body.innerHTML = `<h3 id="quiz-title">Day ${levelNum}</h3><div id="quiz-area"></div>`;
            loadQuestion(levelNum, 0);
        }

        function loadQuestion(level, index) {
            const qData = RAMADAN_QUESTIONS[`level${level}`][index];
            const area = document.getElementById('quiz-area');
            area.innerHTML = `
                <p>Question ${index + 1} of ${RAMADAN_QUESTIONS[`level${level}`].length}</p>
                <h4>${qData.q}</h4>
                <div id="options-box"></div>
            `;

            qData.o.forEach(opt => {
                const b = document.createElement('button');
                b.className = 'main-btn';
                b.style.width = "100%";
                b.style.marginBottom = "10px";
                b.innerText = opt;
                b.onclick = () => checkAnswer(level, index, opt);
                document.getElementById('options-box').appendChild(b);
            });
        }

        function checkAnswer(level, index, selected) {
            const qData = RAMADAN_QUESTIONS[`level${level}`][index];
            if(selected === qData.a) {
                alert("Correct! " + (qData.e || ""));
                if(index + 1 < RAMADAN_QUESTIONS[`level${level}`].length) {
                    loadQuestion(level, index + 1);
                } else {
                    localStorage.setItem(`lvl_${level}`, 'true');
                    alert("Day " + level + " Completed!");
                    renderRamadanGrid();
                }
            } else {
                alert("Incorrect. Try again!");
            }
        }

        function showDuas() {
            showScreen('content');
            const body = document.getElementById('dynamic-body');
            body.innerHTML = '<h2>Daily Duas</h2>';
            DUA_DB.forEach(d => {
                body.innerHTML += `<div class="dua-card"><strong>${d.t}</strong><br><span>${d.a}</span><br><small>${d.tr}</small></div>`;
            });
        }

        function showHadith() {
            showScreen('content');
            const dayIdx = new Date().getDate() % HADITH_LIST.length;
            document.getElementById('dynamic-body').innerHTML = `<h2>Hadith</h2><div class="dua-card" style="text-align:center;">"${HADITH_LIST[dayIdx]}"</div>`;
        }

        function startEidQuiz() {
            // Check if all 30 days are done
            let completedAll = true;
            for(let i=1; i<=30; i++) { if(!localStorage.getItem('lvl_'+i)) completedAll = false; }
            
            if(!completedAll) {
                alert("Please complete all 30 days of Ramadan challenges first!");
                return;
            }
            showCertificate();
        }

        function showCertificate() {
            const user = JSON.parse(localStorage.getItem('iq_user'));
            document.getElementById('dynamic-body').innerHTML = `
                <div style="border:10px double var(--gold); padding:20px; text-align:center; background:white; color:#064e3b;">
                    <h1 style="font-family:Cinzel">CERTIFICATE</h1>
                    <p>Presented to</p>
                    <h2 style="text-transform:uppercase">${user.name}</h2>
                    <p>For successfully completing the 30-Day Ramadan Quest 2026</p>
                    <p><small>Date: Eid-ul-Fitr 2026</small></p>
                </div>
                <button class="main-btn" style="width:100%; margin-top:10px; background:var(--emerald); color:white;" onclick="window.print()">Download Certificate</button>
            `;
        }

        function uploadImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('profile-img').src = e.target.result;
                    document.getElementById('profile-img').style.display = 'block';
                    document.getElementById('avatar-init').style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function toggleTheme() {
            const t = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', t);
        }

        function shareApp() {
            if(navigator.share) navigator.share({title:'Islamic Questz', url: location.href});
        }
    </script>
</body>
</html>
